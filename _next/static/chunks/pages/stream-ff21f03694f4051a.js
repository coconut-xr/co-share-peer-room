(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[245],{83349:function(e,n,t){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,n,t,r){void 0===r&&(r=t);var o=Object.getOwnPropertyDescriptor(n,t);o&&!("get"in o?!n.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,r,o)}:function(e,n,t,r){void 0===r&&(r=t),e[r]=n[t]}),o=this&&this.__exportStar||function(e,n){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(n,t)||r(n,e,t)};Object.defineProperty(n,"__esModule",{value:!0}),o(t(87214),n),o(t(83517),n)},59964:function(e,n,t){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(n){i(n)}}function c(e){try{s(r.throw(e))}catch(n){i(n)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}s((r=r.apply(e,n||[])).next())}))},i=this&&this.__generator||function(e,n){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(e,a)}catch(c){i=[6,c],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.useRoom=void 0;var a=t(27378),c=t(28068),s=t(12938),l=t(75108);n.useRoom=function(e,n,t,u){var f=this,d=(0,a.useState)([]),p=d[0],h=d[1];return(0,a.useEffect)((function(){var a=[],d=function(e){var n=a.findIndex((function(n){return n[0].userData.id===e}));-1!==n&&(a[n][1].close(),a.splice(n,1),h(a.map((function(e){return e[0]}))))},p=function(c){return o(f,void 0,void 0,(function(){var f,m,v=this;return i(this,(function(b){switch(b.label){case 0:return f=t(c),[4,(0,l.connectPeer)(f,(function(){return e.signalObservable.pipe((0,s.filter)((function(e){return e[0]===c})),(0,s.map)((function(e){return e[1]})))}),(function(n){return e.signal(n,c)}),(function(){return o(v,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return d(c),[4,p(c)];case 1:return e.sent(),[2]}}))}))}),(function(e){return r({id:c},null!=u?u(e):{})}),n)];case 1:return m=b.sent(),a.push(m),h(a.map((function(e){return e[0]}))),[2]}}))}))};h((function(e){return e.length>0?[]:e})),e.clients.forEach(p);var m=new c.Subscription;return m.add(e.addClientObservable.subscribe(p)),m.add(e.removeClientObservable.subscribe(d)),function(){m.unsubscribe(),a.forEach((function(e){return e[1].close()}))}}),[e,n,t,u]),p}},87214:function(e,n,t){"use strict";var r=this&&this.__extends||function(){var e=function(n,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},e(n,t)};return function(n,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),o=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var r,o=0,i=n.length;o<i;o++)!r&&o in n||(r||(r=Array.prototype.slice.call(n,0,o)),r[o]=n[o]);return e.concat(r||Array.prototype.slice.call(n))};Object.defineProperty(n,"__esModule",{value:!0}),n.RoomStore=void 0;var i=t(71687),a=t(28068),c=function(e){function n(t,r){void 0===r&&(r=10);var c=e.call(this)||this;return c.maxClients=r,c.subscriber=i.Subscriber.create(n,(function(e,n,t){c.clients.length>=c.maxClients?t("too many clients in this room"):(c.addClient(e.userData.id),n(c.clients.filter((function(n){return n!=e.userData.id}))))})),c.signalObservable=new a.Subject,c.addClientObservable=new a.Subject,c.removeClientObservable=new a.Subject,c.signal=i.Action.create(c,"signal",(function(e,n,t,r){if(null==e)c.signal.publishTo({to:"one",one:c.mainLink},n,t);else if(e.connection.userData.id===t)null!=r&&c.signalObservable.next([r,n]);else{var o=Array.from(c.linkSet).find((function(e){return e.connection.userData.id===t}));if(null==o)throw new Error("unable to find connection with receiver id ".concat(t));c.signal.publishTo({to:"one",one:o},n,t,e.connection.userData.id)}})),c.addClient=i.Action.create(c,"addClient",(function(e,n){c.clients=o(o([],c.clients,!0),[n],!1),c.addClientObservable.next(n),c.addClient.publishTo(null==e?{to:"all"}:{to:"all-except-one",except:e},n)})),c.removeClient=i.Action.create(c,"removeClient",(function(e,n){c.clients=c.clients.filter((function(e){return e!==n})),c.removeClientObservable.next(n),c.removeClient.publishTo(null==e?{to:"all"}:{to:"all-except-one",except:e},n)})),c.clients=t,c}return r(n,e),n.prototype.onLink=function(e){},n.prototype.onUnlink=function(e){this.removeClient(e.connection.userData.id)},n}(i.Store);n.RoomStore=c},83517:function(e,n,t){"use strict";var r=this&&this.__extends||function(){var e=function(n,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},e(n,t)};return function(n,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0}),n.rootStore=n.RoomRootStore=void 0;var o=t(71687),i=t(83349),a=t(28068),c=t(93938),s=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.createRoom=o.Request.create(n,"createGame",(function(e){if(null==e)return n.createRoom.publishTo(n.mainLink);var t=(0,c.v4)();return n.addStore(new i.RoomStore([]),t),(0,a.of)(t)})),n}return r(n,e),n}(o.RootStore);n.RoomRootStore=s,n.rootStore=new s(new Map)},12875:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stream",function(){return t(73642)}])},16673:function(e,n,t){"use strict";t.d(n,{$:function(){return a}});var r=t(24246),o=t(25675),i=function(e){var n=e.src;return"/co-share-peer-room".concat(n)};function a(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsx)("footer",{className:"bg-light",children:(0,r.jsxs)("div",{className:"d-flex align-items-center justify-content-around p-3 container-lg",children:[(0,r.jsxs)("a",{target:"_blank",href:"https://github.com/cocoss-org/co-share-peer-room",className:"mx-2 text-black d-flex flex-row align-items-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-github mx-2",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"})}),(0,r.jsx)("span",{className:"h5 mb-0",children:"Github"})]}),(0,r.jsx)("a",{className:"d-flex mx-2",target:"_blank",href:"https://www.coconut-xr.com/",children:(0,r.jsx)(o.default,{loader:i,layout:"fixed",width:170,height:40,src:"/powered-by.svg"})})]})})]})}},61952:function(e,n,t){"use strict";t.d(n,{h:function(){return c}});var r=t(24246),o=t(41664),i=t(27378),a=[{title:"Stream",url:"/stream"}];function c(e){var n=e.selectedIndex,t=(0,i.useState)(!1),c=t[0],s=t[1];return(0,r.jsx)("nav",{className:"navbar navbar-expand-lg navbar-light bg-light",children:(0,r.jsxs)("div",{className:"container-fluid",children:[(0,r.jsx)(o.default,{href:"/",passHref:!0,children:(0,r.jsx)("a",{className:"navbar-brand",children:"co-share-peer-room examples"})}),(0,r.jsx)("button",{className:"navbar-toggler",type:"button",onClick:function(){return s(!c)},"data-bs-toggle":"collapse","data-bs-target":"#navbarNavDropdown","aria-controls":"navbarNavDropdown","aria-expanded":"false","aria-label":"Toggle navigation",children:(0,r.jsx)("span",{className:"navbar-toggler-icon"})}),(0,r.jsx)("div",{className:"align-self-flex-end navbar-collapse ".concat(c?"":"collapse"),children:(0,r.jsx)("ul",{className:"navbar-nav",children:a.map((function(e,t){var i=e.title,a=e.url;return(0,r.jsx)("li",{className:"nav-item",children:t===n?(0,r.jsx)("span",{style:{cursor:"pointer"},className:"active nav-link",children:i}):(0,r.jsx)(o.default,{href:a,passHref:!0,children:(0,r.jsx)("a",{className:"nav-link",children:i})})},i)}))})})]})})}},73642:function(e,n,t){"use strict";t.r(n),t.d(n,{Environment:function(){return V},default:function(){return Z}});var r=t(24246),o=t(19160),i=t(27378),a=t(472),c=t(18287),s=t(61952),l=t(16673),u=t(94881),f=t(733),d=t.n(f);function p(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function h(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function m(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){h(e,n,t[n])}))}return e}function v(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function b(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,i=[],a=!0,c=!1;try{for(t=t.call(e);!(a=(r=t.next()).done)&&(i.push(r.value),!n||i.length!==n);a=!0);}catch(s){c=!0,o=s}finally{try{a||null==t.return||t.return()}finally{if(c)throw o}}return i}}(e,n)||y(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,n){if(e){if("string"===typeof e)return p(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?p(e,n):void 0}}function j(e){var n=e.device,t=e.OffIcon,o=e.OnIcon,a=e.setStream,s=v(e,["device","OffIcon","OnIcon","setStream"]),l=(0,i.useState)(!1),u=l[0],f=l[1];if(u){var p=function(){return f(!1)},h=[n];return(0,r.jsxs)(i.Suspense,{fallback:(0,r.jsx)(d(),{className:s.className,width:35,height:35,type:"spin",color:"#fff"}),children:[(0,r.jsx)(g,{request:function(e){return(0,c.requestMediaDeviceStream)(e)},onResult:function(e,n){a(e),null==e?(console.error(n),f(!1)):e.addEventListener("inactive",p)},cleanUp:function(e){null!=e&&((0,c.closeStream)(e),e.removeEventListener("inactive",p)),a(void 0)},parameters:h}),(0,r.jsx)(t,m({},s,{onClick:function(){return f(!1)}}))]})}return(0,r.jsx)(o,m({},s,{onClick:function(){return f(!0)}}))}function g(e){var n=e.onResult,t=e.parameters,r=e.request,o=e.cleanUp,a=b((0,u.suspend)((function(){return r.apply(void 0,x(t)).then((function(e){return[e,void 0]})).catch((function(e){return[void 0,e]}))}),t),2),c=a[0],s=a[1];return(0,i.useLayoutEffect)((function(){return n(c,s),function(){o(c,s),(0,u.clear)(t)}}),t),null}var w=t(99663),S=t(54975),O=t(92802),_=t(91389),N=t(29306),C=t(20598),k=t(89646);function I(e){var n=e.audioInput,t=e.screenCapture,o=e.setAudioStream,i=e.setScreenStream,a=e.setVideoStream,c=e.videoInput;return(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center m-3 px-2 bg-dark rounded-pill",children:[n&&(0,r.jsx)(j,{fontSize:"large",className:"m-3 pointer",htmlColor:"#fff",width:300,height:300,OffIcon:w.Z,OnIcon:S.Z,device:n,setStream:o}),c&&(0,r.jsx)(j,{fontSize:"large",className:"m-3 pointer",htmlColor:"#fff",width:300,height:300,OffIcon:O.Z,OnIcon:_.Z,device:c,setStream:a}),t&&(0,r.jsx)(j,{fontSize:"large",className:"m-3 pointer",htmlColor:"#fff",width:300,height:300,OffIcon:N.Z,OnIcon:C.Z,device:t,setStream:i})]})}function D(e){var n=e.stream,t=(0,c.useStreamType)(n),o=(0,i.useRef)(null);switch((0,i.useLayoutEffect)((function(){null!=o.current&&(o.current.srcObject=n,o.current.play().catch(console.error))}),[n]),t){case c.StreamType.AUDIO:return(0,r.jsx)("audio",{ref:o});case c.StreamType.VIDEO:return(0,r.jsx)("video",{playsInline:!0,className:"p-2 flex-grow-1 flex-basis-0",ref:o});default:return o.current=null,(0,r.jsx)(k.Z,{})}}var R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=function(){return(0,r.jsx)(r.Fragment,{})},t=e.components||{},o=t.wrapper;return o?(0,r.jsx)(o,Object.assign({},e,{children:(0,r.jsx)(n,{})})):n()},A=t(54816),P=t(76305),E=t(83349),M=t(59964),T=t(11163);function L(e){var n=e.children,t=e.rootStore,o=(0,i.useRef)(null),a=(0,T.useRouter)(),c=(0,i.useMemo)((function(){return"string"===typeof a.query.roomId?n(a.query.roomId):void 0}),[a]);return null==c?(0,r.jsx)("div",{className:"flex-grow-1 d-flex align-items-center justify-content-center flex-column",children:(0,r.jsxs)("div",{className:"d-flex flex-column rounded shadow p-3",children:[(0,r.jsx)(q,{rootStore:t,router:a}),(0,r.jsx)("hr",{}),(0,r.jsxs)("div",{className:"d-flex flex-row",children:[(0,r.jsx)("input",{className:"me-3",ref:o,placeholder:"##########"}),(0,r.jsx)("button",{onClick:function(){return a.push({query:{roomId:o.current.value}},void 0,{shallow:!0})},className:"btn btn-secondary",children:"Join Room"})]})]})}):c}function q(e){var n=e.rootStore,t=e.router,o=(0,i.useState)(void 0),a=o[0],c=o[1];return null==a||"error"===a.type?(0,r.jsx)("button",{className:"btn btn-primary",onClick:function(){c({type:"loading"}),n.createRoom().subscribe({next:function(e){return t.push({query:{roomId:e}},void 0,{shallow:!0})},error:function(e){return c({type:"error",message:e.message})}})},children:"Create Room"}):(0,r.jsx)(d(),{width:35,height:35,type:"spin",color:"#fff"})}function Z(){return(0,r.jsxs)("div",{className:"d-flex flex-column fullscreen",children:[(0,r.jsx)(s.h,{selectedIndex:1}),(0,r.jsxs)("div",{className:"d-flex flex-column justify-content-stretch container-lg",children:[(0,r.jsx)("div",{style:{height:"calc(90vh - 176px)"},className:"d-flex flex-row-responsive border mt-3",children:(0,r.jsx)(V,{})}),(0,r.jsx)("div",{className:"p-3 flex-basis-0 flex-grow-1",children:(0,r.jsx)(R,{})})]}),(0,r.jsx)(l.$,{})]})}function z(e){return{instance:e}}function U(e){return{id:e.id}}var G="undefined"===typeof t.g.window?"":"https://cspr-provider.azurewebsites.net";function V(){return(0,r.jsx)(A.SocketIOConnection,{providedRootStore:E.rootStore,userData:U,fallback:"Connecting ...",url:G,children:(0,r.jsx)(L,{rootStore:E.rootStore,children:function(e){return(0,r.jsx)(i.Suspense,{fallback:(0,r.jsx)(d(),{width:35,height:35,type:"spin",color:"#fff"}),children:(0,r.jsx)($,{roomId:e})})}})})}function $(e){var n=e.roomId,t=(0,P.useStoreSubscription)(n,1e3,(function(e){return new E.RoomStore(e)}),void 0,E.rootStore),o=(0,i.useMemo)((function(){return new a.RootStore(new Map)}),[t]),c=(0,M.useRoom)(t,o,(0,i.useCallback)((function(e){return{initiator:e>t.mainLink.connection.userData.id}}),[t.mainLink.connection.userData.id]),z);return(0,r.jsx)(B,{connectionAmount:c.length,children:(0,r.jsx)(i.Suspense,{fallback:null,children:(0,r.jsx)(F,{connections:c})})})}function B(e){var n=e.children,t=e.connectionAmount,o=(0,i.useState)(!1),a=o[0],c=o[1];return a?n:(0,r.jsx)("div",{className:"flex-grow-1 d-flex align-items-center justify-content-center flex-column",children:(0,r.jsxs)("div",{className:"d-flex flex-column rounded shadow p-3",children:[(0,r.jsxs)("h5",{children:["You are joining a room with ",t," users."]}),(0,r.jsx)("button",{onClick:function(){return c(!0)},className:"btn btn-primary",children:"Ok"})]})})}function F(e){var n=e.connections,t=(0,i.useState)(void 0),o=t[0],a=t[1],s=(0,i.useState)(void 0),l=s[0],u=s[1],f=(0,i.useState)(void 0),d=f[0],p=f[1],h=(0,i.useMemo)((function(){return[o,l,d].filter(X)}),[o,l,d]),m=(0,c.useMediaDevices)(),v=(0,c.useSelectDefaultMediaDevice)("audioinput",m),b=(0,c.useSelectDefaultMediaDevice)("videoinput",m),x=(0,c.useSelectDefaultMediaDevice)("screencapture",m);return(0,r.jsxs)("div",{className:"d-flex flex-grow-1 flex-column overflow-hidden flex-basis-0",children:[(0,r.jsx)("div",{className:"d-flex flex-grow-1 flex-basis-0 flex-row overflow-hidden justify-content-around overflow-hidden",children:n.map((function(e){return(0,r.jsx)(H,{connection:e,outgoingStreams:h},e.userData.id)}))}),(0,r.jsx)("div",{className:"d-flex flex-row align-items-center justify-content-center",children:(0,r.jsx)(I,{audioInput:v,videoInput:b,screenCapture:x,setAudioStream:a,setVideoStream:u,setScreenStream:p})})]})}function H(e){var n=e.outgoingStreams,t=e.connection,i=(0,o.useIncommingPeerStreams)(t.userData.peer);return(0,o.useOutgoingPeerStream)(t.userData.peer,n),(0,r.jsxs)("div",{className:"d-flex flex-grow-1 flex-basis-0 flex-column overflow-hidden justify-content-around overflow-hidden",children:[i.map((function(e){return(0,r.jsx)(D,{stream:e},e.id)})),(0,r.jsx)("h5",{className:"text-center",children:t.userData.id})]})}function X(e){return null!=e}},52361:function(){},94616:function(){},50471:function(){},71632:function(){}},function(e){e.O(0,[61,510,774,888,179],(function(){return n=12875,e(e.s=n);var n}));var n=e.O();_N_E=n}]);